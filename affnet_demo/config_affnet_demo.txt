# compute_normals, compute_normals_compare run_sequential_pipeline, run_matching_pipeline
method = run_matching_pipeline
permutation_limit = 1

rotation_alpha1 = 1.0
rotation_alpha2 = 1.0

rectify_by_fixed_rotation = False
rectify_by_0_around_z = False
rectify_by_GT = False

singular_value_quantil = 1.0
mean_shift = mean
handle_antipodal_points = False
all_unrectified = False

scene_name = scene1
#scene_name = phototourism/st_peters_square
file_name_suffix = .jpg
# or 'orig'
scene_type = orig
#scene_type = google
#output_dir = work/pipeline_wc
matching_difficulties_min = 0
matching_difficulties_max = 1
matching_limit = 1

# matching_pairs = 99175391_4486295587_75464488_8690807252
# matching_pairs = 99261069_5958624644_00977754_11239843025, 99261069_5958624644_05050551_9555711650

# diff 0 scene 1 - AFAIK all repeating structures
# matching_pairs = frame_0000001650_1_frame_0000000730_3, frame_0000000655_4_frame_0000000565_2, frame_0000001670_1_frame_0000000705_3, frame_0000001010_1_frame_0000001085_1, frame_0000001030_4_frame_0000000960_4, frame_0000000260_4_frame_0000000105_3, frame_0000000125_3_frame_0000000255_4, frame_0000000320_3_frame_0000000085_4, frame_0000000315_3_frame_0000000085_4, frame_0000000145_3_frame_0000000250_3
# diff 3 scene 1
# too sharp of an angle
# matching_pairs = frame_0000000690_3_frame_0000002345_1
# matching_pairs = frame_0000000160_1_frame_0000000695_1

# not that difficult I think
# matching_pairs = frame_0000000995_1_frame_0000001610_3

#matching_pairs = frame_0000001650_1_frame_0000000730_3

# good
# matching_pairs = frame_0000001285_1_frame_0000001145_1
# matching_pairs = frame_0000000845_1_frame_0000001060_1

# BAD
# matching_pairs = frame_0000001610_4_frame_0000001580_4 - diff result!
# matching_pairs = frame_0000000060_4_frame_0000000055_4 - diff result
# matching_pairs = frame_0000001440_4_frame_0000000270_1

# BAD for all (rect, unrect, planes), possibly repeating patterns
# matching_pairs = frame_0000001650_1_frame_0000000730_3

# degensac hurts !!!
# matching_pairs = frame_0000000655_4_frame_0000000565_2


#matching_pairs = frame_0000001670_1_frame_0000000705_3
#matching_pairs = frame_0000000695_3_frame_0000000535_4


# unrectified - much less inliers!!! - rectification hurts
# matching_pairs = frame_0000000385_2_frame_0000000670_2

# unrectified - much less inliers!!! - rectification hurts
#matching_pairs = frame_0000001290_1_frame_0000001655_1

#matching_pairs = frame_0000001610_4_frame_0000001580_4
#matching_pairs = frame_0000001440_4_frame_0000000270_1

#matching_pairs = frame_0000001650_1_frame_0000000730_3

##matching_pairs = frame_0000001865_1_frame_0000001355_1, frame_0000000545_3_frame_0000001555_1, frame_0000000430_4_frame_0000001525_1, frame_0000001910_1_frame_0000001345_1, frame_0000000660_4_frame_0000001095_3, frame_0000000700_2_frame_0000000700_1, frame_0000000975_3_frame_0000000720_1, frame_0000001225_1_frame_0000000650_3, frame_0000001165_1_frame_0000000390_2, frame_0000001315_1_frame_0000001910_1

#matching_pairs = frame_0000001115_1_frame_0000000335_2, frame_0000000405_1_frame_0000001050_3, frame_0000001345_4_frame_0000001315_1, frame_0000000895_2_frame_0000000710_3, frame_0000002110_1_frame_0000000970_3, frame_0000000205_2_frame_0000000935_3, frame_0000001510_1_frame_0000001255_4, frame_0000001210_4_frame_0000000740_3, frame_0000001210_3_frame_0000000280_2, frame_0000001500_1_frame_0000001430_3, frame_0000001595_1_frame_0000001395_3, frame_0000001250_2_frame_0000001125_4, frame_0000000550_2_frame_0000001205_4, frame_0000000555_2_frame_0000001225_4, frame_0000000185_2_frame_0000000870_4, frame_0000001530_1_frame_0000000200_2, frame_0000001520_1_frame_0000000650_1, frame_0000001225_1_frame_0000001335_4, frame_0000000935_3_frame_0000000590_1, frame_0000001585_3_frame_0000000945_4, frame_0000000870_3_frame_0000000215_2, frame_0000001415_1_frame_0000002190_1, frame_0000000610_3_frame_0000000910_4, frame_0000001035_3_frame_0000000235_2, frame_0000000485_3_frame_0000000665_2, frame_0000001510_1_frame_0000001250_4, frame_0000001500_1_frame_0000000660_1, frame_0000001360_1_frame_0000000255_2, frame_0000000915_4_frame_0000000175_2, frame_0000000785_3_frame_0000001230_4, frame_0000000630_2_frame_0000001155_2, frame_0000000495_3_frame_0000000905_4, frame_0000000740_2_frame_0000001250_4, frame_0000000900_1_frame_0000000290_2, frame_0000000865_3_frame_0000002080_1, frame_0000000695_3_frame_0000001170_4, frame_0000000500_3_frame_0000000860_4, frame_0000001050_2_frame_0000000665_4, frame_0000000920_3_frame_0000000465_4, frame_0000001115_2_frame_0000000900_4, frame_0000001515_1_frame_0000000330_4, frame_0000000690_1_frame_0000000765_4, frame_0000000990_1_frame_0000000445_2, frame_0000000495_4_frame_0000001010_4, frame_0000001105_4_frame_0000000580_4, frame_0000000640_2_frame_0000000415_3, frame_0000001450_3_frame_0000001425_1, frame_0000001465_4_frame_0000001285_3, frame_0000001085_4_frame_0000000270_2, frame_0000000770_3_frame_0000000960_2
#matching_pairs = frame_0000001470_1_frame_0000001385_3


###matching_pairs = frame_0000000120_2_frame_0000000835_4
#, frame_0000000745_3_frame_0000000170_3, frame_0000001575_4_frame_0000000970_1, frame_0000002435_1_frame_0000000790_3, frame_0000001700_1_frame_0000000145_3, frame_0000000505_3_frame_0000001065_4, frame_0000002470_1_frame_0000000510_2, frame_0000000940_1_frame_0000001460_4, frame_0000000570_2_frame_0000002355_1, frame_0000001355_3_frame_0000000040_1

##matching_pairs = 99261069_5958624644_82891910_8557580346
#, 89969840_182829979_43753249_471195516, 99261069_5958624644_05396311_7478824750, 99261069_5958624644_73058973_5746646370, 99175391_4486295587_40872338_3860687096, 96441840_5987269620_67962895_4081662170, 96441840_5987269620_36779284_11205924426, 99261069_5958624644_53051837_8602864506, 89973786_8024710201_68224611_7326286810

# matching_pairs = frame_0000001470_1_frame_0000001385_3, frame_0000001395_1_frame_0000000710_1, frame_0000001315_1_frame_0000001515_3, frame_0000001185_1_frame_0000001510_3, frame_0000001825_3_frame_0000001460_3, frame_0000001225_2_frame_0000001200_1, frame_0000001350_4_frame_0000001250_3, frame_0000001195_3_frame_0000001555_3, frame_0000000690_2_frame_0000001845_1, frame_0000000975_4_frame_0000000560_4, frame_0000000360_3_frame_0000001610_1, frame_0000001265_3_frame_0000001375_4, frame_0000000785_4_frame_0000001085_1, frame_0000001120_4_frame_0000000830_3, frame_0000001120_2_frame_0000000910_4, frame_0000001875_1_frame_0000000915_3, frame_0000000655_2_frame_0000000825_1, frame_0000001730_1_frame_0000000470_4, frame_0000000695_2_frame_0000000335_2, frame_0000000620_4_frame_0000001160_3, frame_0000000730_4_frame_0000001075_3, frame_0000000840_2_frame_0000001000_1, frame_0000000745_2_frame_0000001090_1, frame_0000001235_1_frame_0000000715_4, frame_0000000835_1_frame_0000000665_2, frame_0000000670_1_frame_0000001110_4, frame_0000001640_1_frame_0000001555_1, frame_0000001360_1_frame_0000001640_1, frame_0000000765_2_frame_0000000960_1, frame_0000000845_1_frame_0000000885_4, frame_0000001290_1_frame_0000001655_1, frame_0000000905_4_frame_0000001060_1, frame_0000000890_1_frame_0000000695_4, frame_0000001605_1_frame_0000000405_4, frame_0000001370_3_frame_0000000745_2

# matching_pairs = frame_0000000520_3_frame_0000001875_1
#frame_0000002390_1_frame_0000000240_4
# frame_0000001670_1_frame_0000000705_3, frame_0000000125_3_frame_0000000255_4, frame_0000000225_3_frame_0000000265_4
#, frame_0000000165_2_frame_0000000450_4, frame_0000001510_3_frame_0000001475_3, frame_0000000280_3_frame_0000000055_2, frame_0000001260_3_frame_0000000920_2, frame_0000000245_3_frame_0000000240_4, frame_0000001115_4_frame_0000001100_4, frame_0000000270_3_frame_0000000255_4, frame_0000001045_3_frame_0000001120_3, frame_0000000185_4_frame_0000000335_3, frame_0000001345_4_frame_0000001310_4, frame_0000000350_2_frame_0000000630_3, frame_0000000615_3_frame_0000000570_4, frame_0000001835_1_frame_0000001815_1, frame_0000001135_4_frame_0000001165_4, frame_0000001440_4_frame_0000001500_4, frame_0000000310_3_frame_0000000065_2, frame_0000001535_4_frame_0000000305_1, frame_0000000205_3_frame_0000000105_3, frame_0000000215_1_frame_0000001310_2, frame_0000002055_1_frame_0000002065_1, frame_0000000270_4_frame_0000000135_4, frame_0000000575_3_frame_0000000590_3, frame_0000000560_3_frame_0000000565_4, frame_0000000535_4_frame_0000001845_1, frame_0000000355_1_frame_0000000250_1, frame_0000001480_3_frame_0000001190_2, frame_0000002055_1_frame_0000000400_4, frame_0000000135_3_frame_0000000035_3, frame_0000000095_1_frame_0000001345_2, frame_0000000965_1_frame_0000001230_3, frame_0000002310_1_frame_0000000355_3, frame_0000001680_3_frame_0000001650_3, frame_0000000450_3_frame_0000002135_1, frame_0000000270_4_frame_0000000210_3, frame_0000002400_1_frame_0000002460_1, frame_0000000535_3_frame_0000000450_3, frame_0000001285_1_frame_0000001145_1, frame_0000000250_4_frame_0000000300_4, frame_0000001385_4_frame_0000000485_1, frame_0000000470_1_frame_0000000395_1, frame_0000000250_4_frame_0000000135_4, frame_0000000320_3_frame_0000000085_4, frame_0000000340_4_frame_0000000385_4, frame_0000000800_2_frame_0000001020_3, frame_0000000175_2_frame_0000000405_3

# plane based best satisfying diff=6
# frame_0000001070_4_frame_0000000335_1, frame_0000001380_1_frame_0000002270_1, frame_0000001535_3_frame_0000000805_2, frame_0000000335_1_frame_0000001180_3, frame_0000000900_1_frame_0000000555_4, frame_0000001640_1_frame_0000001210_1, frame_0000000530_2_frame_0000001200_4, frame_0000000600_3_frame_0000001165_1, frame_0000001210_3_frame_0000001900_1, frame_0000000515_2_frame_0000001095_2, frame_0000000630_1_frame_0000000715_2, frame_0000001100_1_frame_0000000545_4, frame_0000000840_3_frame_0000001035_1, frame_0000001870_1_frame_0000001255_1, frame_0000001360_1_frame_0000000445_4, frame_0000000820_1_frame_0000000645_4, frame_0000000625_3_frame_0000001240_1, frame_0000000750_2_frame_0000001125_2, frame_0000000975_4_frame_0000000620_1, frame_0000000990_1_frame_0000000720_4, frame_0000000720_1_frame_0000000880_3
# matching_pairs = frame_0000001070_4_frame_0000000335_1, frame_0000001380_1_frame_0000002270_1, frame_0000001535_3_frame_0000000805_2

# matching_pairs = frame_0000001620_3_frame_0000000450_1
# matching_pairs = frame_0000001010_1_frame_0000001085_1, frame_0000000770_4_frame_0000000685_4, frame_0000000660_3_frame_0000001890_1
# matching_pairs = IMG_20210728_092359_IMG_20210728_092414

# matching_pairs = frame_0000001805_3_frame_0000000650_1, frame_0000000420_4_frame_0000002375_1, frame_0000001115_1_frame_0000001575_1
# , frame_0000000475_3_frame_0000001860_1, frame_0000001815_1_frame_0000000125_2
# matching_pairs = frame_0000001510_4_frame_0000001260_2, frame_0000000420_4_frame_0000002375_1
# matching_pairs = frame_0000000080_4_frame_0000000405_1
# matching_pairs = frame_0000002150_1_frame_0000000985_4
# matching_pairs = frame_0000001370_1_frame_0000000685_3
# matching_pairs = frame_0000000060_4_frame_0000000055_4
# matching_pairs = frame_0000000060_4_frame_0000000595_3
# matching_pairs = frame_0000001460_4_frame_0000001105_2
#frame_0000000325_4_frame_0000000120_4

# CUDA baseline diff(dR, dR_GT) > 10 degrees
# matching_pairs = frame_0000000060_4_frame_0000000055_4, frame_0000001535_4_frame_0000000305_1, frame_0000000475_3_frame_0000000060_2, frame_0000002165_1_frame_0000000075_2, frame_0000000655_4_frame_0000000565_2, frame_0000000750_1_frame_0000001460_3, frame_0000000770_4_frame_0000000685_4, frame_0000000420_2_frame_0000000755_3, frame_0000000125_3_frame_0000000255_4, frame_0000000165_2_frame_0000000450_4, frame_0000001035_4_frame_0000001095_4

# diff 0, inlier ration ~0
# matching_pairs = frame_0000001535_4_frame_0000000305_1, frame_0000000475_3_frame_0000000060_2

#matching_pairs = frame_0000000730_3_frame_0000001995_1, frame_0000000505_2_frame_0000001705_1, frame_0000000070_2_frame_0000000505_3, frame_0000001510_4_frame_0000001260_2, frame_0000002160_1_frame_0000000135_4, frame_0000000380_1_frame_0000001510_4, frame_0000000100_2_frame_0000000570_3, frame_0000000135_3_frame_0000000345_4, frame_0000001005_4_frame_0000001300_1, frame_0000001680_3_frame_0000001235_2, frame_0000000590_3_frame_0000002280_1, frame_0000000145_3_frame_0000000330_4, frame_0000002090_1_frame_0000000170_4, frame_0000000275_3_frame_0000000230_2, frame_0000000215_2_frame_0000002375_1, frame_0000000265_2_frame_0000000540_4, frame_0000000190_4_frame_0000000395_3, frame_0000000325_4_frame_0000000120_4, frame_0000000385_1_frame_0000001760_3, frame_0000001195_1_frame_0000001075_4, frame_0000000265_3_frame_0000000090_3

#matching_pairs = frame_0000000655_4_frame_0000000565_2, frame_0000000695_3_frame_0000000535_4, frame_0000000750_1_frame_0000001460_3, frame_0000000770_4_frame_0000000685_4, frame_0000000785_2_frame_0000000710_2, frame_0000000165_2_frame_0000000450_4, frame_0000001035_4_frame_0000001095_4, frame_0000000145_3_frame_0000000250_3, frame_0000000520_3_frame_0000001875_1, frame_0000000115_3_frame_0000000165_4, frame_0000000240_1_frame_0000000200_1, frame_0000000430_4_frame_0000000180_2, frame_0000001405_3_frame_0000001250_4, frame_0000001260_3_frame_0000000920_2, frame_0000000980_3_frame_0000000665_2, frame_0000002140_1_frame_0000000405_3,
#matching_pairs = frame_0000001005_4_frame_0000001300_1
#matching_pairs = frame_0000000085_3_frame_0000002190_1
#matching_pairs = frame_0000000505_2_frame_0000000425_3
# matching_pairs = frame_0000000470_4_frame_0000000060_3

# diff=4, first 10
# frame_0000001400_4_frame_0000001015_1, frame_0000000725_3_frame_0000001775_1, frame_0000000250_4_frame_0000000810_3, frame_0000001300_3_frame_0000001425_4, frame_0000000535_4_frame_0000000285_4
# at least (2, 1) (6-10)
matching_pairs = frame_0000001585_4_frame_0000001035_2, frame_0000001350_2_frame_0000001015_1, frame_0000000765_2_frame_0000000465_3, frame_0000000085_4_frame_0000000410_2, frame_0000000640_4_frame_0000000055_4

#chosen_depth_files = frame_0000001865_1
#chosen_depth_files = frame_0000001525_1.jpg
# chosen_depth_files = 99261069_5958624644.jpg
#chosen_depth_files = frame_0000000070_2.jpg, frame_0000001525_1.jpg, frame_0000001865_1.jpg


ransac_th = 0.5
ransac_conf = 0.9999
ransac_iters = 100000

fginn = False
num_nn = 2
fginn_spatial_th = 100
ratio_th = 0.5

planes_based_matching = False
rectify = True
clip_angle = None

feature_descriptor = SIFT
n_features = None
use_hardnet = False

# cartesian, max_one_non_default, just_one_non_default
config_combination = cartesian

# final, before_matching, before_rectification
pipeline_final_step = before_rectification

do_flann = False

knn_ratio_threshold = 0.85

use_degensac = False
estimate_k = False
focal_point_mean_factor = 0.5

#show and save

show_input_img = True
show_matching = True
show_clusters = False
show_clustered_components = True
show_rectification = False
show_sky_mask = True

save_clusters = False
save_matching = True
save_clustered_components = False
save_rectification = False
save_sky_mask = False

use_cached_img_data = False

upsample_early = True
connected_components_connectivity = 4

connected_components_closing_size = None
connected_components_flood_fill = False
